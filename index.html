<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>to-fix</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='//api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js'></script>
<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
<link href='//api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.css' rel='stylesheet' />
<link href='//www.mapbox.com/base/latest/base.css' rel='stylesheet'>
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>

<div id='map'></div>
<script>
    var url = 'http://54.91.116.141:3000/error/';

    function qs(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    var map = L.mapbox.map('map', 'aaronlidman.inhj344j').setView([22.76, -25.84], 3);
    $(function() {
        load();
    });

    function load() {
        $.ajax({
            crossDomain: true,
            url: url + qs('error')
        }).done(function(data) {
            loader[qs('error')](data, function() {
                // idk
            });
        });
    }

    var loader = {};
    loader['keepright/deadendoneway'] = keeprights;
    loader['keepright/highwaywater'] = keeprights;
    loader['keepright/impossibleangle'] = keeprights;
    loader['keepright/mixedlayer'] = keeprights;
    loader['keepright/nonclosedways'] = keeprights;

    function keeprights(data, cb) {
        data = JSON.parse(data);
        omnivore.wkt.parse(data.st_astext).addTo(map);
        // populate UI
        // bind stuff
        // open in JOSM
        cb();
    }

</script>

</body>
</html>
